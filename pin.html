<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
    .duelo {
      display: flex;
      flex-direction: column;
      gap: 6px;
      background: white;
      padding: 10px;
      border-radius: 10px;
      margin: 10px auto;
      max-width: 500px;
      text-align: left;
    }
    #whatsappBtn { display: none; margin-top: 20px; }
    button { padding: 10px 15px; background: #25d366; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #1ebd5b; }
    #dataHora { margin-top: 10px; font-weight: bold; color: #444; }
    .codigoInput{
        text-align:center;
        dispaly:flex;
        height:30px;
        background:black;
        color:white;
    }
  </style>
</head>
<body>
  <h2>Buscar Aposta por CÃ³digo</h2>
  <input class="codigoInput" type="text" id="codigoBusca" placeholder="Ex: 123456" />
  <button id="btnBuscar">Buscar</button>

  <div id="resultado"></div>
  <p id="dataHora"></p>
  <button id="whatsappBtn">ðŸ“² Enviar no WhatsApp</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyA5a-2HzvcljnAfXE7P3ThDnq6m6E568ZA",
  authDomain: "jogo-60a9e.firebaseapp.com",
  projectId: "jogo-60a9e",
  storageBucket: "jogo-60a9e.appspot.com",
  messagingSenderId: "352852303591",
  appId: "1:352852303591:web:8083c950047c9026bd8c42",
  databaseURL: "https://jogo-60a9e-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const btnBuscar = document.getElementById("btnBuscar");
const resultado = document.getElementById("resultado");
const dataHoraEl = document.getElementById("dataHora");
const whatsappBtn = document.getElementById("whatsappBtn");

btnBuscar.onclick = () => {
  const codigo = document.getElementById("codigoBusca").value.trim();
  resultado.innerHTML = "";
  dataHoraEl.textContent = "";
  whatsappBtn.style.display = "none";

  if (!codigo) return alert("Digite o cÃ³digo!");

  get(child(ref(db), `apostas/${codigo}`)).then(snapshot => {
    if (snapshot.exists()) {
      const dados = snapshot.val();

      const nome = dados.nome || "Desconhecido";
      const data = new Date(dados.dataRegistro);
      const dataFormatada = data.toLocaleString("pt-BR");
      const valorUnicoGlobal = dados.duelos?.[0]?.valorUnico?.toFixed(2) || "0,00";
      const valorTotal = dados.valorTotal?.toFixed(2) || "0,00";

      dataHoraEl.innerHTML = `
        ðŸ‘¤ Nome: ${nome}<br>
        ðŸ“… Data da aposta: ${dataFormatada}<br>
        ðŸ’¸ VALOR A PAGAR: R$ ${valorUnicoGlobal}<br>
        ðŸ’° TOTAL RECEBER: R$ ${valorTotal}
      `;

      let mensagemWhatsapp = `ðŸ‘¤ Nome: ${nome}\nðŸ“… Data: ${dataFormatada}\nðŸ’¸ Valor Ãšnico: R$ ${valorUnicoGlobal}\nðŸ’° Total Geral: R$ ${valorTotal}\n============================\n`;

      (dados.duelos || []).forEach((duelo, i) => {
        const jogo = document.createElement("div");
        jogo.className = "duelo";

        const timeA = duelo.nomeTimeA || duelo.duelo?.split(" x ")[0] || "Time A";
        const timeB = duelo.nomeTimeB || duelo.duelo?.split(" x ")[1] || "Time B";
        const dataHoraJogo = new Date(duelo.dataHora).toLocaleString("pt-BR");

        let selecaoTexto = "NÃ£o selecionado";

        if (duelo.selecaoA) {
          selecaoTexto = typeof duelo.selecaoA === 'string'
            ? duelo.selecaoA.replace("|", " ")
            : duelo.selecaoA.texto.replace("|", " ");
        } else if (duelo.selecaoB) {
          selecaoTexto = typeof duelo.selecaoB === 'string'
            ? duelo.selecaoB.replace("|", " ")
            : duelo.selecaoB.texto.replace("|", " ");
        }

        jogo.innerHTML = `
          <strong>Jogo:</strong> ${timeA} x ${timeB}<br>
          <strong>Escolha:</strong> ${selecaoTexto}<br>
          <strong>Data/Hora do Jogo:</strong> ${dataHoraJogo}
        `;

        resultado.appendChild(jogo);

        mensagemWhatsapp += `\nâš½ ${timeA} x ${timeB}\nðŸŽ¯ Escolha: ${selecaoTexto}\nðŸ•’ ${dataHoraJogo}\n============================`;
      });

      whatsappBtn.style.display = "inline-block";
      whatsappBtn.onclick = () => {
        const url = `https://wa.me/?text=${encodeURIComponent(mensagemWhatsapp)}`;
        window.open(url, "_blank");
      };
    } else {
      resultado.innerHTML = "<p><strong>CÃ³digo nÃ£o encontrado.</strong></p>";
    }
  }).catch(error => {
    console.error("Erro ao buscar:", error);
    alert("Erro ao buscar cÃ³digo.");
  });
};
</script>
</body>
</html>
