<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel de Monitoramento</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background: #1a1a1a;
    color: #00ff7f;
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h1 {
    color: #00ff7f;
    margin-bottom: 20px;
  }

  .card {
    background: #111;
    border: 2px solid #00ff7f;
    border-radius: 12px;
    padding: 20px;
    margin: 10px 0;
    width: 90%;
    max-width: 600px;
    box-shadow: 0 0 10px #00ff7f33;
  }

  .card h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.4rem;
    color: #00ff7f;
    border-bottom: 1px solid #00ff7f;
    padding-bottom: 5px;
  }

  .saldo {
    display: flex;
    justify-content: space-between;
    font-size: 1.2rem;
    margin-bottom: 10px;
  }

  input, button {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
  }

  button {
    background: #00ff7f;
    color: #111;
    cursor: pointer;
    transition: all 0.2s;
  }

  button:hover {
    background: #1aff7f;
  }

  ul {
    list-style: none;
    padding: 0;
    max-height: 200px;
    overflow-y: auto;
  }

  li {
    margin: 5px 0;
    padding: 5px;
    border-bottom: 1px solid #00ff7f33;
    font-size: 0.95rem;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }

  th, td {
    padding: 5px;
    text-align: left;
  }

  th {
    border-bottom: 1px solid #00ff7f;
  }

  td {
    border-bottom: 1px solid #00ff7f33;
  }

  /* Modal de saque */
  .modal {
    display: none; 
    position: fixed; 
    z-index: 1000; 
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background: #111;
    color: #00ff7f;
    padding: 20px;
    border-radius: 12px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 0 15px #00ff7f66;
  }

  .modal-content input {
    width: 90%;
    margin: 10px 0;
  }

  .modal-buttons {
    display: flex;
    justify-content: space-between;
  }

  .modal-buttons button {
    flex:1;
    margin:5px;
    font-size: 1rem;
  }

  #cancelarBtn{background:#555;color:#00ff7f;}
  #enviarBtn{background:#00ff7f;color:#111;}
</style>
</head>
<body>

<h1>Painel de Monitoramento</h1>

<!-- Saldo -->
<div class="card">
  <h2>Saldo</h2>
  <div class="saldo">
    <div id="saldo">Saldo Atual: R$ 0</div>
    <div id="saldoGanho">Saldo Ganhou: R$ 0</div>
  </div>
</div>

<!-- Liberar Código -->
<div class="card">
  <h2>Liberar Código</h2>
  <input type="text" id="codigoLiberar" placeholder="Digite o código">
  <button onclick="liberarCodigo()">Liberar Código</button>
  <p id="mensagem"></p>
  <ul id="listaCodigos"></ul>
</div>

<!-- Saque Pix -->
<div class="card">
  <h2>Saque Pix</h2>
  <button id="btnSaque">Solicitar Saque</button>
  <table id="tabelaSaques">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Pix</th>
        <th>Valor</th>
        <th>Data / Hora</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Modal -->
<div id="modalSaque" class="modal">
  <div class="modal-content">
    <h2>Solicitar Pix</h2>
    <input type="text" id="nomeInput" placeholder="Digite seu Nome">
    <input type="text" id="pixInput" placeholder="Digite seu Pix">
    <input type="number" id="valorInput" placeholder="Digite o valor R$">
    <div class="modal-buttons">
      <button id="cancelarBtn">Cancelar</button>
      <button id="enviarBtn">Enviar</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, get, update, onValue, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBw8nq_MTcdc91y0nG7jeTvROsAaz1Hj8U",
  authDomain: "geladeira-58de2.firebaseapp.com",
  databaseURL: "https://geladeira-58de2-default-rtdb.firebaseio.com",
  projectId: "geladeira-58de2",
  storageBucket: "geladeira-58de2.firebasestorage.app",
  messagingSenderId: "823625324816",
  appId: "1:823625324816:web:7c8a19cabd6461ff666d95",
  measurementId: "G-W547T81JCQ"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Referências
const saldoRef = ref(db, "saldo");
const saldoGanhoRef = ref(db, "saldoGanho");
const codigosRef = ref(db, "codigos");
const saquesRef = ref(db, "saques");

// Códigos premiados
const codigosPremios = {
      
500:["1408192080533"],
  50:["716412153","592315254","846882055","14081980","195668863","653096775","504350967","635551900","286671413","732888662"],
  40:["217565914","919970432","284338877","101696966","702396411","229654597","874019900","621211660","336075928","485986854"],
  30:["739656664","465396612","189768711","112988691","966044327","595658875","109617523","899800852","755223288","960909264"],
  20:["446224299","394127635","812879695","960907900","491988844","249227980","956544658","349657657","840757998","217686049"],
  
  18: [
    "1656644222", "7586885601", "3889888532", "0868655653", "5678901234",
    "6789012345", "7890123456", "8901234637", "9012345678", "9876543210"
  ],
  16: [
    "1977609555", "223545568", "33766567757", "1264667888", "5566778899",
    "6867758900", "7788990011", "8899001122", "9900112233", "1546888831"
  ],
  14: [
    "1756567650", "2029896620","3087767030", "4765566980", "500998674",
    "6060606060", "7754478870", "8086522264", "12644644480", "9008654664"
  ],
  12: [
    "1357913579", "2468024680", "1123581321", "3141592653", "2718281828",
    "1414213562", "1618033988", "1732050807", "2236067977", "2449489742"
  ],
  10: [ "691539989","811999998","108784815","313505598","806528891","366228474","716094153","592329854","846668855","504376967"],
  9:["874016500","621216610","336090028","485980154","635598519","286682713","732880862","195658863","653677587","129458884"],
  8:["956535448","003496557","840776998","217612049","739668764","466345912","189763211","112967891","904432227","595665575"],
  7:["673207856","209122885","487021874","337834017","596597699","387881987","978833854","699939985","767384775","560098454"],
  6:["673275056","209651885","487029814","337808817","596587999","367871987","309878265","317746673","507846877","999297604"],
  5:["986476585","443438755","978638854","699975985","767388775","005600454","647728865","878863674","441365795","965878854"],
  4:["109613223","899876852","755228448","960976264","216594314","919098432","284337447","101697666","702397611"],
  3:["309821965","317663273","507683477","929766404","446224552","394128835","887963495","960901270","491987744","249212270"],
  2:["647720985","878867472","441379895","987877854","691997689","811977998","108488515","313503398","806521291","366222274"],
  1:["teste1336262","teste00001122","teste0062525","teste97288862999","teste62527882","teste4425252516"],
  
};

// Inicializa códigos no Firebase
for (const valor in codigosPremios) {
  codigosPremios[valor].forEach(codigo => {
    set(ref(db, "codigos/" + codigo), { usado: false, valor: Number(valor) });
  });
}

// Variáveis
let saldoAtual = 0;
let saldoGanho = 0;

// Monitora saldo em tempo real
onValue(saldoRef, snapshot => {
  saldoAtual = snapshot.val() || 0;
  document.getElementById("saldo").textContent = "Saldo Atual: R$ " + saldoAtual;
});

onValue(saldoGanhoRef, snapshot => {
  saldoGanho = snapshot.val() || 0;
  document.getElementById("saldoGanho").textContent = "Saldo Ganhou: R$ " + saldoGanho;
});

// Lista de códigos disponíveis
function atualizarListaCodigos() {
  get(codigosRef).then(snapshot => {
    const lista = document.getElementById("listaCodigos");
    lista.innerHTML = "";
    if (snapshot.exists()) {
      const codigos = snapshot.val();
      for (let key in codigos) {
        if (!codigos[key].usado) {
          const li = document.createElement("li");
          li.textContent = `${key} - R$ ${codigos[key].valor}`;
          lista.appendChild(li);
        }
      }
    }
  });
}
  
// Liberar código
window.liberarCodigo = async function() {
  const codigoInput = document.getElementById("codigoLiberar").value.toUpperCase();
  const msg = document.getElementById("mensagem");

  const snapshot = await get(ref(db, "codigos/" + codigoInput));
  if (!snapshot.exists()) {
    msg.textContent = "Código inválido!";
    return;
  }

  const data = snapshot.val();
  if (data.usado) {
    msg.textContent = "Código já utilizado!";
    return;
  }

  saldoAtual += data.valor;
  saldoGanho += data.valor;
  await set(saldoRef, saldoAtual);
  await set(saldoGanhoRef, saldoGanho);
  await update(ref(db, "codigos/" + codigoInput), { usado: true });

  msg.textContent = `Crédito de R$${data.valor} liberado!`;
  atualizarListaCodigos();
};

// Modal de saque
const modal = document.getElementById('modalSaque');
const nomeInput = document.getElementById('nomeInput');
const pixInput = document.getElementById('pixInput');
const valorInput = document.getElementById('valorInput');
const cancelarBtn = document.getElementById('cancelarBtn');
const enviarBtn = document.getElementById('enviarBtn');
const tabelaSaques = document.getElementById('tabelaSaques').querySelector('tbody');

document.getElementById('btnSaque').addEventListener('click', ()=>{
  if(saldoGanho <= 0){
    alert("Não há saldo ganho para sacar!");
    return;
  }
  modal.style.display = 'flex';
  valorInput.value = saldoGanho;
});

cancelarBtn.addEventListener('click', ()=>{
  modal.style.display = 'none';
  nomeInput.value = '';
  pixInput.value = '';
  valorInput.value = '';
});

enviarBtn.addEventListener('click', async ()=>{
  const nome = nomeInput.value.trim();
  const pix = pixInput.value.trim();
  const valor = parseFloat(valorInput.value);

  if(!nome || !pix || isNaN(valor) || valor <= 0){
    alert('Preencha corretamente Nome, Pix e valor.');
    return;
  }

  if(valor > saldoGanho){
    alert("Valor solicitado maior que o saldo ganho!");
    return;
  }

  const saque = {
    nome: nome,
    pix: pix,
    valor: valor,
    data: new Date().toLocaleString()
  };

  const newSaqueRef = push(saquesRef);
  await set(newSaqueRef, saque);

  saldoGanho -= valor;
  await set(saldoGanhoRef, saldoGanho);

  modal.style.display = 'none';
  nomeInput.value = '';
  pixInput.value = '';
  valorInput.value = '';
});

// Atualiza lista de saques em tempo real
onValue(saquesRef, snapshot=>{
  tabelaSaques.innerHTML = '';
  if(snapshot.exists()){
    const saques = snapshot.val();
    for(let key in saques){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${saques[key].nome}</td>
        <td>${saques[key].pix}</td>
        <td>R$ ${saques[key].valor.toFixed(2)}</td>
        <td>${saques[key].data}</td>
      `;
      tabelaSaques.appendChild(tr);
    }
  }
});
function zera(){
    localStorage.clear();
}
zera()
// Carrega lista inicial de códigos
atualizarListaCodigos();
</script>

</body>
</html>
