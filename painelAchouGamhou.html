<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel de Monitoramento - Saques</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    background: #f0f0f0; 
    margin: 0; 
    padding: 0; 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    min-height: 100vh;
  }

  h1 { 
    text-align: center; 
    color: #333; 
    margin: 20px 0; 
  }

  #status {
    margin-top: 10px; 
    text-align:center; 
    font-size: 1rem;
  }

  table { 
    width: 95%; 
    max-width: 1200px;
    border-collapse: collapse; 
    margin: 20px 0; 
    background: white; 
    table-layout: fixed;
    word-wrap: break-word;
  }

  th, td { 
    border: 1px solid #ccc; 
    padding: 8px; 
    text-align: center; 
    font-size: 0.9rem;
  }

  th { 
    background: #0077cc; 
    color: white; 
  }

  tr:nth-child(even) { 
    background: #f9f9f9; 
  }

  .btn-delete { 
    cursor: pointer; 
    color: red; 
    font-weight: bold; 
    border: none; 
    background: none; 
    font-size: 16px; 
  }

  .btn-status {
    cursor: pointer;
    border: none;
    padding: 5px 10px;
    font-size: 14px;
    border-radius: 5px;
    color: white;
    font-weight: bold;
  }

  .btn-verde {
    background: green;
  }

  .btn-vermelho {
    background: red;
  }

  /* Para telas pequenas */
  @media (max-width: 768px) {
    th, td {
      font-size: 0.75rem;
      padding: 6px;
    }
    .btn-delete, .btn-status {
      font-size: 14px;
      padding: 4px 8px;
    }
  }

  @media (max-width: 480px) {
    table {
      width: 100%;
    }
    th, td {
      font-size: 0.7rem;
      padding: 4px;
    }
    h1 {
      font-size: 1.2rem;
    }
  }
</style>
</head>
<body>

<h1>Painel de Monitoramento de Saques</h1>
<p id="status">Conectando ao Firebase...</p>
<table>
  <thead>
    <tr>
      <th>Nome</th>
      <th>Pix</th>
      <th>Valor Saque (R$)</th>
      <th>WhatsApp</th>
      <th>Valor Compra (R$)</th>
      <th>Data/Hora</th>
      <th>Status</th>
      <th>Excluir</th>
    </tr>
  </thead>
  <tbody id="tabelaSaques">
    <!-- Linhas serão adicionadas dinamicamente -->
  </tbody>
</table>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBw8nq_MTcdc91y0nG7jeTvROsAaz1Hj8U",
    authDomain: "geladeira-58de2.firebaseapp.com",
    databaseURL: "https://geladeira-58de2-default-rtdb.firebaseio.com",
    projectId: "geladeira-58de2",
    storageBucket: "geladeira-58de2.firebasestorage.app",
    messagingSenderId: "823625324816",
    appId: "1:823625324816:web:7c8a19cabd6461ff666d95",
    measurementId: "G-W547T81JCQ"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const tabela = document.getElementById("tabelaSaques");
  const status = document.getElementById("status");
  const saquesRef = ref(db, 'saques');

  // Função para salvar no localStorage
  function salvarStatusLocal(key, valor) {
    let statusSaques = JSON.parse(localStorage.getItem("statusSaques")) || {};
    statusSaques[key] = valor;
    localStorage.setItem("statusSaques", JSON.stringify(statusSaques));
  }

  // Função para carregar status do localStorage
  function carregarStatusLocal(key) {
    let statusSaques = JSON.parse(localStorage.getItem("statusSaques")) || {};
    return statusSaques[key] || "❌";
  }

  onValue(saquesRef, snapshot => {
    const dados = snapshot.val();
    tabela.innerHTML = '';

    if (dados) {
      Object.entries(dados).forEach(([key, item]) => {
        const tr = document.createElement('tr');
        const data = new Date(item.data).toLocaleString();

        // Pega o status salvo no localStorage
        let statusAtual = carregarStatusLocal(key);
        let classe = statusAtual === "✅" ? "btn-verde" : "btn-vermelho";

        tr.innerHTML = `
          <td>${item.nome || '-'}</td>
          <td>${item.pix || '-'}</td>
          <td>${Number(item.valor).toFixed(2)}</td>
          <td>${item.whatsapp || '-'}</td>
          <td>${item.valorCompra || '-'}</td>
          <td>${data}</td>
          <td><button class="btn-status ${classe}" data-key="${key}">${statusAtual}</button></td>
          <td><button class="btn-delete" data-key="${key}">X</button></td>
        `;
        tabela.appendChild(tr);
      });
      status.textContent = `Total de saques: ${Object.keys(dados).length}`;
      
      // Botão de excluir
      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', () => {
          const key = btn.getAttribute('data-key');
          if(confirm('Deseja realmente excluir este saque?')) {
            remove(ref(db, 'saques/' + key))
              .then(() => {
                alert('Saque excluído com sucesso!');
                localStorage.removeItem(key); // também remove do localStorage
              })
              .catch(err => alert('Erro ao excluir: ' + err));
          }
        });
      });

      // Botão de status
      document.querySelectorAll('.btn-status').forEach(btn => {
        btn.addEventListener('click', () => {
          const key = btn.getAttribute('data-key');
          let novoValor = btn.textContent === "✅" ? "❌" : "✅";
          btn.textContent = novoValor;
          btn.classList.toggle("btn-verde");
          btn.classList.toggle("btn-vermelho");
          salvarStatusLocal(key, novoValor);
        });
      });

    } else {
      status.textContent = 'Nenhum saque registrado ainda.';
    }
  }, error => {
    status.textContent = 'Erro ao conectar ao Firebase.';
    console.error(error);
  });
</script>

</body>
</html>
