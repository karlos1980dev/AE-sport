<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel de Monitoramento</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background: #1a1a1a;
    color: #00ff7f;
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h1 {
    color: #00ff7f;
    margin-bottom: 20px;
  }

  .card {
    background: #111;
    border: 2px solid #00ff7f;
    border-radius: 12px;
    padding: 20px;
    margin: 10px 0;
    width: 90%;
    max-width: 600px;
    box-shadow: 0 0 10px #00ff7f33;
  }

  .card h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.4rem;
    color: #00ff7f;
    border-bottom: 1px solid #00ff7f;
    padding-bottom: 5px;
  }

  .saldo {
    display: flex;
    justify-content: space-between;
    font-size: 1.2rem;
    margin-bottom: 10px;
  }

  input, button {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
  }

  button {
    background: #00ff7f;
    color: #111;
    cursor: pointer;
    transition: all 0.2s;
  }

  button:hover {
    background: #1aff7f;
  }

  ul {
    list-style: none;
    padding: 0;
    max-height: 200px;
    overflow-y: auto;
  }

  li {
    margin: 5px 0;
    padding: 5px;
    border-bottom: 1px solid #00ff7f33;
    font-size: 0.95rem;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }

  th, td {
    padding: 5px;
    text-align: left;
  }

  th {
    border-bottom: 1px solid #00ff7f;
  }

  td {
    border-bottom: 1px solid #00ff7f33;
  }

  /* Modal de saque */
  .modal {
    display: none; 
    position: fixed; 
    z-index: 1000; 
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background: #111;
    color: #00ff7f;
    padding: 20px;
    border-radius: 12px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 0 15px #00ff7f66;
  }

  .modal-content input {
    width: 90%;
    margin: 10px 0;
  }

  .modal-buttons {
    display: flex;
    justify-content: space-between;
  }

  .modal-buttons button {
    flex:1;
    margin:5px;
    font-size: 1rem;
  }

  #cancelarBtn{background:#555;color:#00ff7f;}
  #enviarBtn{background:#00ff7f;color:#111;}
</style>
</head>
<body>

<h1>Painel de Monitoramento</h1>

<!-- Saldo -->
<div class="card">
  <h2>Saldo</h2>
  <div class="saldo">
    <div id="saldo">Saldo Atual: R$ 0</div>
    <div id="saldoGanho">Saldo Ganhou: R$ 0</div>
  </div>
</div>

<!-- Liberar Código -->
<div class="card">
  <h2>Liberar Código</h2>
  <input type="text" id="codigoLiberar" placeholder="Digite o código">
  <button onclick="liberarCodigo()">Liberar Código</button>
  <p id="mensagem"></p>
  <ul id="listaCodigos"></ul>
</div>

<!-- Saque Pix -->
<div class="card">
  <h2>Saque Pix</h2>
  <button id="btnSaque">Solicitar Saque</button>
  <table id="tabelaSaques">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Pix</th>
        <th>Valor</th>
        <th>Data / Hora</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Modal -->
<div id="modalSaque" class="modal">
  <div class="modal-content">
    <h2>Solicitar Pix</h2>
    <input type="text" id="nomeInput" placeholder="Digite seu Nome">
    <input type="text" id="pixInput" placeholder="Digite seu Pix">
    <input type="number" id="valorInput" placeholder="Digite o valor R$">
    <div class="modal-buttons">
      <button id="cancelarBtn">Cancelar</button>
      <button id="enviarBtn">Enviar</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, get, update, onValue, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBw8nq_MTcdc91y0nG7jeTvROsAaz1Hj8U",
  authDomain: "geladeira-58de2.firebaseapp.com",
  databaseURL: "https://geladeira-58de2-default-rtdb.firebaseio.com",
  projectId: "geladeira-58de2",
  storageBucket: "geladeira-58de2.firebasestorage.app",
  messagingSenderId: "823625324816",
  appId: "1:823625324816:web:7c8a19cabd6461ff666d95",
  measurementId: "G-W547T81JCQ"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Referências
const saldoRef = ref(db, "saldo");
const saldoGanhoRef = ref(db, "saldoGanho");
const codigosRef = ref(db, "codigos");
const saquesRef = ref(db, "saques");

// Códigos premiados
const codigosPremios = {
300:["0000"],
50: ["YHEHWH","ABC7123","7999"],
30: ["526262","625262"],
20: ["XYZ123","LMN456"],
10: ["AAA111","BBB222"],
2: ["CCC333","DDD444"]
};

// Inicializa códigos no Firebase
for (const valor in codigosPremios) {
  codigosPremios[valor].forEach(codigo => {
    set(ref(db, "codigos/" + codigo), { usado: false, valor: Number(valor) });
  });
}

// Variáveis
let saldoAtual = 0;
let saldoGanho = 0;

// Monitora saldo em tempo real
onValue(saldoRef, snapshot => {
  saldoAtual = snapshot.val() || 0;
  document.getElementById("saldo").textContent = "Saldo Atual: R$ " + saldoAtual;
});

onValue(saldoGanhoRef, snapshot => {
  saldoGanho = snapshot.val() || 0;
  document.getElementById("saldoGanho").textContent = "Saldo Ganhou: R$ " + saldoGanho;
});

// Lista de códigos disponíveis
function atualizarListaCodigos() {
  get(codigosRef).then(snapshot => {
    const lista = document.getElementById("listaCodigos");
    lista.innerHTML = "";
    if (snapshot.exists()) {
      const codigos = snapshot.val();
      for (let key in codigos) {
        if (!codigos[key].usado) {
          const li = document.createElement("li");
          li.textContent = `${key} - R$ ${codigos[key].valor}`;
          lista.appendChild(li);
        }
      }
    }
  });
}
  
// Liberar código
window.liberarCodigo = async function() {
  const codigoInput = document.getElementById("codigoLiberar").value.toUpperCase();
  const msg = document.getElementById("mensagem");

  const snapshot = await get(ref(db, "codigos/" + codigoInput));
  if (!snapshot.exists()) {
    msg.textContent = "Código inválido!";
    return;
  }

  const data = snapshot.val();
  if (data.usado) {
    msg.textContent = "Código já utilizado!";
    return;
  }

  saldoAtual += data.valor;
  saldoGanho += data.valor;
  await set(saldoRef, saldoAtual);
  await set(saldoGanhoRef, saldoGanho);
  await update(ref(db, "codigos/" + codigoInput), { usado: true });

  msg.textContent = `Crédito de R$${data.valor} liberado!`;
  atualizarListaCodigos();
};

// Modal de saque
const modal = document.getElementById('modalSaque');
const nomeInput = document.getElementById('nomeInput');
const pixInput = document.getElementById('pixInput');
const valorInput = document.getElementById('valorInput');
const cancelarBtn = document.getElementById('cancelarBtn');
const enviarBtn = document.getElementById('enviarBtn');
const tabelaSaques = document.getElementById('tabelaSaques').querySelector('tbody');

document.getElementById('btnSaque').addEventListener('click', ()=>{
  if(saldoGanho <= 0){
    alert("Não há saldo ganho para sacar!");
    return;
  }
  modal.style.display = 'flex';
  valorInput.value = saldoGanho;
});

cancelarBtn.addEventListener('click', ()=>{
  modal.style.display = 'none';
  nomeInput.value = '';
  pixInput.value = '';
  valorInput.value = '';
});

enviarBtn.addEventListener('click', async ()=>{
  const nome = nomeInput.value.trim();
  const pix = pixInput.value.trim();
  const valor = parseFloat(valorInput.value);

  if(!nome || !pix || isNaN(valor) || valor <= 0){
    alert('Preencha corretamente Nome, Pix e valor.');
    return;
  }

  if(valor > saldoGanho){
    alert("Valor solicitado maior que o saldo ganho!");
    return;
  }

  const saque = {
    nome: nome,
    pix: pix,
    valor: valor,
    data: new Date().toLocaleString()
  };

  const newSaqueRef = push(saquesRef);
  await set(newSaqueRef, saque);

  saldoGanho -= valor;
  await set(saldoGanhoRef, saldoGanho);

  modal.style.display = 'none';
  nomeInput.value = '';
  pixInput.value = '';
  valorInput.value = '';
});

// Atualiza lista de saques em tempo real
onValue(saquesRef, snapshot=>{
  tabelaSaques.innerHTML = '';
  if(snapshot.exists()){
    const saques = snapshot.val();
    for(let key in saques){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${saques[key].nome}</td>
        <td>${saques[key].pix}</td>
        <td>R$ ${saques[key].valor.toFixed(2)}</td>
        <td>${saques[key].data}</td>
      `;
      tabelaSaques.appendChild(tr);
    }
  }
});

// Carrega lista inicial de códigos
atualizarListaCodigos();
</script>

</body>
</html>
