<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verificar Aposta</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
  <div class="container mt-4">
    <h3>Verifica√ß√£o Autom√°tica</h3>
    <div id="resultadoVerificacao" class="mt-4"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA5a-2HzvcljnAfXE7P3ThDnq6m6E568ZA",
      authDomain: "jogo-60a9e.firebaseapp.com",
      projectId: "jogo-60a9e",
      storageBucket: "jogo-60a9e.appspot.com",
      messagingSenderId: "352852303591",
      appId: "1:352852303591:web:8083c950047c9026bd8c42",
      databaseURL: "https://jogo-60a9e-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const resultadoDiv = document.getElementById("resultadoVerificacao");

    async function verificarApostaAuto() {
      const urlParams = new URLSearchParams(window.location.search);
      const codigo = urlParams.get("id");

      if (!codigo) {
        resultadoDiv.innerHTML = `<div class='alert alert-danger'>C√≥digo inv√°lido na URL.</div>`;
        return;
      }

      const dbRef = ref(db);
      try {
        const snapshot = await get(child(dbRef, `apostas/${codigo}`));
        if (!snapshot.exists()) {
          resultadoDiv.innerHTML = `<div class='alert alert-danger'>Aposta n√£o encontrada.</div>`;
          return;
        }

        const aposta = snapshot.val();
        const resultadosSnapshot = await get(child(dbRef, "resultados"));
        const resultados = resultadosSnapshot.val() || {};

        let acertos = 0;
        let html = `<h5>C√≥digo: ${codigo}</h5><ul class='list-group mb-3'>`;

        (aposta.duelos || []).forEach(duelo => {
          const timeA = duelo?.nomeTimeA || "Time A";
          const timeB = duelo?.nomeTimeB || "Time B";
          const escolha = duelo?.escolha || "N√£o informada";
          const chave = `${timeA} x ${timeB}`;
          const resultadoReal = resultados[chave]?.resultado || "Sem resultado";
          const placar = resultados[chave]?.placar || "??x??";
          const acertou = resultadoReal === escolha;

          html += `
            <li class='list-group-item d-flex justify-content-between ${acertou ? "list-group-item-success" : "list-group-item-danger"}'>
              <div>
                <strong>${chave}</strong><br/>
                üèÅ Resultado: ${resultadoReal} | Placar: ${placar}
              </div>
              <div>
                üéØ Sua aposta: <strong>${escolha}</strong><br/>
                ${acertou ? "‚úÖ Acertou!" : `‚ùå Errou`}
              </div>
            </li>
          `;

          if (acertou) acertos++;
        });

        html += `</ul><div class='alert alert-info'>‚úÖ Total de acertos: ${acertos} de ${aposta.duelos.length}</div>`;
        resultadoDiv.innerHTML = html;
      } catch (err) {
        console.error("Erro ao verificar aposta:", err);
        resultadoDiv.innerHTML = `<div class='alert alert-danger'>Erro ao verificar aposta.</div>`;
      }
    }

    verificarApostaAuto();
  </script>
</body>
</html>
