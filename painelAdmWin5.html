<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel ADM de Códigos</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #000;
    color: white;
  }
  .container {
    max-width: 800px;
    margin: 20px auto;
    background: purple;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 10px #444;
  }
  h1, h2 { color: gold; text-align: center; }
  input, button {
    padding: 10px;
    margin: 5px 0;
    width: 100%;
    box-sizing: border-box;
    border-radius: 5px;
    border: none;
  }
  button {
    background: green;
    color: white;
    cursor: pointer;
  }
  #mensagem {
    margin-top: 20px;
    padding: 10px;
    background: #eee;
    color: black;
    border-radius: 5px;
    white-space: pre-line;
    word-break: break-word;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 30px;
  }
  th, td {
    padding: 10px;
    border: 1px solid #fff;
    text-align: center;
  }
  th { background: #444; }
  tr:nth-child(even) { background: #333; }
  .btn-excluir {
    background: red;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    padding: 5px 10px;
  }
</style>
</head>
<body>

<div class="container">
  <h2>Painel ADM - Gerar Códigos</h2>
  
  <label for="nivel">Valor Reais:</label>
  <input type="number" id="nivel" placeholder="VALOR R$">
  
  <input type="number" id="quantidade" placeholder="Digite a quantidade">
  
  <button id="buscar">Buscar Códigos</button>
  
  <div id="mensagem"></div>
</div>

<div class="container">
<h1>Usuários em Tempo Real</h1>
<table>
  <thead>
    <tr>
      <th>ID do Usuário</th>
      <th>Saldo (R$)</th>
      <th>Ganho Total (R$)</th>
      <th>Ação</th>
    </tr>
  </thead>
  <tbody id="usuariosTabela">
    <!-- Dados vão aparecer aqui -->
  </tbody>
</table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCqh1ZtEASGhNEK_8CbUiha9jPyqfwalA4",
  authDomain: "winx5-f4bd2.firebaseapp.com",
  databaseURL: "https://winx5-f4bd2-default-rtdb.firebaseio.com",
  projectId: "winx5-f4bd2",
  storageBucket: "winx5-f4bd2.appspot.com",
  messagingSenderId: "539880532364",
  appId: "1:539880532364:web:c75b0d6ac32fc6ce830ea9"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const usuariosRef = ref(db, "usuarios");

// Atualizar tabela em tempo real
onValue(usuariosRef, (snapshot) => {
    const data = snapshot.val();
    const tbody = document.getElementById("usuariosTabela");
    tbody.innerHTML = ""; // limpar tabela

    if(data){
        Object.keys(data).forEach(userId => {
            const user = data[userId];
            const tr = document.createElement("tr");
            
            const ganho = parseFloat(user.ganhoTotal || 0);
            if(ganho >= 200){
                tr.style.background = "green";
                tr.style.color = "white";
            }

            tr.innerHTML = `
                <td>${userId}</td>
                <td>R$ ${parseFloat(user.saldo || 0).toFixed(2)}</td>
                <td>R$ ${ganho.toFixed(2)}</td>
                <td><button class="btn-excluir">X</button></td>
            `;

            // Evento para excluir usuário
            tr.querySelector(".btn-excluir").addEventListener("click", () => {
                const userRef = ref(db, `usuarios/${userId}`);
                remove(userRef)
                  .then(() => alert(`Usuário ${userId} excluído com sucesso!`))
                  .catch(err => alert("Erro ao excluir: " + err));
            });

            tbody.appendChild(tr);
        });
    }
});

// --- Gerar códigos ---
const codigos = {
  50: ["716412153","592315254","846882055","14081980","195668863","653096775","504350967","635551900","286671413","732888662"],
  40: ["217565914","919970432","284338877","101696966","702396411","229654597","874019900","621211660","336075928","485986854"],
  30: ["739656664","465396612","189768711","112988691","966044327","595658875","109617523","899800852","755223288","960909264"],
  20: ["446224299","394127635","812879695","960907900","491988844","249227980","956544658","349657657","840757998","217686049"],
  10: ["691539989","811999998","108784815","313505598","806528891","366228474","716094153","592329854","846668855","504376967"],
  
};

function pegarCodigosAleatorios(arr, n) {
  const copia = [...arr];
  const resultado = [];
  n = Math.min(n, arr.length);
  for (let i = 0; i < n; i++) {
    const idx = Math.floor(Math.random() * copia.length);
    resultado.push(copia[idx]);
    copia.splice(idx, 1);
  }
  return resultado;
}

document.getElementById("buscar").addEventListener("click", () => {
  const nivel = document.getElementById("nivel").value;
  const quantidade = parseInt(document.getElementById("quantidade").value);
  const mensagemDiv = document.getElementById("mensagem");
  
  if (!codigos[nivel]) {
    mensagemDiv.textContent = "Nível inválido!";
    return;
  }
  if (!quantidade || quantidade <= 0) {
    mensagemDiv.textContent = "Quantidade inválida!";
    return;
  }
  
  const selecionados = pegarCodigosAleatorios(codigos[nivel], quantidade);
  
  let listaFormatada = selecionados.map((codigo, index) => `${index + 1} └──► ${codigo}`).join('\n');
  const mensagem = `✨ CÓDIGOS GERADOS ✨\n\n${listaFormatada}\n\n${quantidade} código(s) gerado(s).`;
  
  mensagemDiv.innerText = mensagem;
  
  const numero = '5571992290058';
  const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensagem)}`;
  window.open(url, '_blank');
});
</script>

</body>
</html>
